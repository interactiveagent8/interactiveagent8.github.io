(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6239:function(e,t,n){Promise.resolve().then(n.bind(n,6864))},6864:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var a=n(7437),s=n(6232),i=n(666),r=n(5448),o=n(4551),l=n(2415),c=n(8954),d=n(8937),u=n(121),x=n(958),f=n(1082),h=n(2265),m=n(4495),v=n(2608),g=n(9044),p=n(2734),j=n(3178),w=n(4839);function y(e){let{label:t,placeholder:n,input:s,onSubmit:i,setInput:r,endContent:o,disabled:c=!1,loading:d=!1}=e;function u(){""!==s.trim()&&(i(),r(""))}return(0,a.jsx)(g.Y,{endContent:(0,a.jsxs)("div",{className:"flex flex-row items-center h-full",children:[o,(0,a.jsx)(p.e,{content:"Send message",children:d?(0,a.jsx)(l.c,{className:"text-indigo-300 hover:text-indigo-200",size:"sm",color:"default"}):(0,a.jsx)("button",{type:"submit",className:"focus:outline-none",onClick:u,children:(0,a.jsx)(j.u,{className:(0,w.Z)("text-indigo-300 hover:text-indigo-200",c&&"opacity-50"),size:24})})})]}),label:t,placeholder:n,size:"sm",value:s,onKeyDown:e=>{"Enter"===e.key&&u()},onValueChange:r,isDisabled:c})}function A(){let[e,t]=(0,h.useState)(!1),[n,g]=(0,h.useState)(!1),[p,j]=(0,h.useState)(),[w,A]=(0,h.useState)(),[S,N]=(0,h.useState)("0487280e01ed4eae8c3acd1b339ab0b5"),[E,b]=(0,h.useState)("37f4d912aa564663a1cf8d63acd0e1ab"),[k,T]=(0,h.useState)("en"),[C,_]=(0,h.useState)(),[D,P]=(0,h.useState)(""),R=(0,h.useRef)(null),z=(0,h.useRef)(null),[I,B]=(0,h.useState)("text_mode"),[O,V]=(0,h.useState)(!1);async function L(){try{let e=await fetch("/api/get-access-token",{method:"POST"}),t=await e.text();return console.log("Access Token:",t),t}catch(e){console.error("Error fetching access token:",e)}return""}async function U(){var e,n,a,i;t(!0);let r=await L();z.current=new s.ZP({token:r}),z.current.on(s.t6.AVATAR_START_TALKING,e=>{console.log("Avatar started talking",e)}),z.current.on(s.t6.AVATAR_STOP_TALKING,e=>{console.log("Avatar stopped talking",e)}),z.current.on(s.t6.STREAM_DISCONNECTED,()=>{console.log("Stream disconnected"),G()}),null===(e=z.current)||void 0===e||e.on(s.t6.STREAM_READY,e=>{console.log(">>>>> Stream ready:",e.detail),j(e.detail)}),null===(n=z.current)||void 0===n||n.on(s.t6.USER_START,e=>{console.log(">>>>> User started talking:",e),V(!0)}),null===(a=z.current)||void 0===a||a.on(s.t6.USER_STOP,e=>{console.log(">>>>> User stopped talking:",e),V(!1)});try{let e=await z.current.createStartAvatar({quality:s.JZ.Low,avatarName:E,knowledgeId:S,voice:{rate:1.5,emotion:s.BC.EXCITED},language:k,disableIdleTimeout:!0});_(e),await (null===(i=z.current)||void 0===i?void 0:i.startVoiceChat({useSilencePrompt:!1})),B("voice_mode")}catch(e){console.error("Error starting avatar session:",e)}finally{t(!1)}}async function Z(){if(g(!0),!z.current){A("Avatar API not initialized");return}await z.current.speak({text:D,taskType:s.UA.REPEAT,taskMode:s.AX.SYNC}).catch(e=>{A(e.message)}),g(!1)}async function K(){if(!z.current){A("Avatar API not initialized");return}await z.current.interrupt().catch(e=>{A(e.message)})}async function G(){var e;await (null===(e=z.current)||void 0===e?void 0:e.stopAvatar()),j(void 0)}let M=(0,m.Z)(async e=>{var t,n;e!==I&&("text_mode"===e?null===(t=z.current)||void 0===t||t.closeVoiceChat():await (null===(n=z.current)||void 0===n?void 0:n.startVoiceChat()),B(e))}),Y=(0,v.Z)(D);return(0,h.useEffect)(()=>{var e,t;!Y&&D?null===(e=z.current)||void 0===e||e.startListening():Y&&!D&&(null==z||null===(t=z.current)||void 0===t||t.stopListening())},[D,Y]),(0,h.useEffect)(()=>()=>{G()},[]),(0,h.useEffect)(()=>{p&&R.current&&(R.current.srcObject=p,R.current.onloadedmetadata=()=>{R.current.play(),A("Playing")})},[R,p]),(0,a.jsx)("div",{className:"w-full flex flex-col gap-4",children:(0,a.jsxs)(i.w,{children:[(0,a.jsx)(r.G,{className:"h-[500px] flex flex-col justify-center items-center",children:p?(0,a.jsxs)("div",{className:"h-[500px] w-[900px] justify-center items-center flex rounded-lg overflow-hidden",children:[(0,a.jsx)("video",{ref:R,autoPlay:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"contain"},children:(0,a.jsx)("track",{kind:"captions"})}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 absolute bottom-3 right-3",children:[(0,a.jsx)(o.A,{className:"bg-gradient-to-r from-[#EE7BB3] to-[#6DC4AD] text-white hover:opacity-90 transition-opacity rounded-lg",size:"md",variant:"shadow",onPress:K,children:"Interrupt task"}),(0,a.jsx)(o.A,{className:"bg-gradient-to-r from-[#EE7BB3] to-[#6DC4AD] text-white hover:opacity-90 transition-opacity rounded-lg",size:"md",variant:"shadow",onPress:G,children:"End session"})]})]}):e?(0,a.jsx)(l.c,{color:"default",size:"lg"}):(0,a.jsxs)("div",{className:"h-full justify-center items-center flex flex-col gap-8 w-[500px] self-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold leading-none",children:"Start a new Chat session"}),(0,a.jsx)(o.A,{className:"bg-gradient-to-r from-[#EE7BB3] to-[#6DC4AD] text-white   hover:opacity-90 transition-opacity",size:"lg",variant:"shadow",onPress:U,children:"Start session"})]})}),(0,a.jsx)(c.j,{}),p&&(0,a.jsxs)(d.i,{className:"flex flex-col gap-3 relative",children:[(0,a.jsxs)(u.n,{"aria-label":"Options",selectedKey:I,onSelectionChange:e=>{M(e)},children:[(0,a.jsx)(x.r,{title:"Text mode"},"text_mode"),(0,a.jsx)(x.r,{title:"Voice mode"},"voice_mode")]}),"text_mode"===I?(0,a.jsxs)("div",{className:"w-full flex relative",children:[(0,a.jsx)(y,{disabled:!p,input:D,label:"Chat",loading:n,placeholder:"Type something for the avatar to respond",setInput:P,onSubmit:Z}),D&&(0,a.jsx)(f.z,{className:"absolute right-16 top-3",children:"Listening"})]}):(0,a.jsx)("div",{className:"w-full text-center",children:(0,a.jsx)(o.A,{isDisabled:!O,className:"bg-gradient-to-r from-[#EE7BB3] to-[#6DC4AD] text-white   hover:opacity-90 transition-opacity",size:"md",variant:"shadow",children:O?"Listening":"Voice chat"})})]})]})})}function S(){return(0,a.jsx)("div",{className:"w-screen h-screen flex flex-col",children:(0,a.jsx)("div",{className:"w-[900px] flex flex-col items-start justify-start gap-5 mx-auto pt-4 pb-20",children:(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(A,{})})})})}}},function(e){e.O(0,[481,578,564,870,971,23,744],function(){return e(e.s=6239)}),_N_E=e.O()}]);